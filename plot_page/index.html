<!DOCTYPE html>
<html>
	<head>
        <meta charset="utf-8" />
		<title>MPU6050 Signal Plotting</title>


		<link rel="stylesheet" type="text/css" href="normalize.css" />
		<link rel="stylesheet" type="text/css" href="style.css" />

		<link rel="stylesheet" type="text/css" href="package/semantic/css/semantic.min.css" />
		<script language="javascript" type="text/javascript" src="package/semantic/javascript/semantic.min.js"></script>

		<script language="javascript" type="text/javascript" src="package/jquery/jquery-2.0.3.min.js"></script>
		<script language="javascript" type="text/javascript" src="package/flot/jquery.flot.min.js"></script>
		<script language="javascript" type="text/javascript" src="package/flot/jquery.flot.crosshair.min.js"></script>
		<script>

			$(function() {

				var number_of_signal = 200;
				// set update interval in micro second (ms)
				var updateInterval = 1;

				function update() {
					var url = 'http://localhost:8888/?callback=?';
					$.getJSON(url, function(data) {
						for (var i = 0; i < data.data.length; ++i) {
							data.data[i].label = data.data[i].label + " = 0";
						}
						plot.setData(data.data);
						plot.draw();
						uplate_legend();
					});
					setTimeout(update, updateInterval);
				};

				var signal_type = ['x-acc = 0', 'y-acc = 0', 'z-acc = 0', 'x-gyro = 0', 'y-gyro = 0', 'z-gyro = 0'];
				var init = [];

				for (var i = 0; i < 6; ++i) {
					var init_signal = [];
					for (var j = 0; j < number_of_signal; ++j) {
						init_signal.push([j, 0]);
					}
					init.push({
						label: signal_type[i],
						data: init_signal
					});
				}

				var plot = $.plot('#signal-plot', init, {
					series: { 
						lines: { show: true, lineWidth: 1 },
						shadowSize: 0 },
					crosshair: { mode: "x" },
					grid: { hoverable: true, autoHighlight: false },
					xaxis: { show: false },
					yaxis: { min: -36000, max: 36000 },
					legend: { position: "sw" }
				});

				var legends = $('#signal-plot .legendLabel');

				var latest_pos = null;
				var update_legend_timeout = null;

				function uplate_legend() {
					update_legend_timeout = null;
					var pos = latest_pos;

					var axes = plot.getAxes();

					if (pos.x < axes.xaxis.min || pos.x > axes.xaxis.max ||
						pos.y < axes.yaxis.min || pos.y > axes.yaxis.max) {
						return;
					}

					var dataset = plot.getData();

					for (var i = 0; i < dataset.length; ++i) {
						var series = dataset[i];

						var idx = Math.floor(pos.x);

						var p1 = series.data[idx], p2 = series.data[idx + 1];
						var ret = null;

						ret = (p1 == null) ? p2[1] : p1[1];
						var new_label = series.label.replace(/=.*/, "= " + ret);
						legends.eq(i).text(new_label);
					}
				};

				$('#signal-plot').bind("plothover", function (event, pos, iten) {
					latest_pos = pos;
					if (!update_legend_timeout) {
						update_legend_timeout = setTimeout(uplate_legend, 50);
					}
				});

				update();

			});
		

		</script>
	</head>
	<body>
	  <div class="ui one column page grid segment">
			<div class="column">
				<h1 class="ui header"><i class="chart basic teal icon"></i>MPU6050 Signal Plotting</i></h1>

				<div id="signal-plot" class="ui teal segment"></div>
			</div>

		</div>
		
	</body>
</html>

